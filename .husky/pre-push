#!/bin/bash

echo "ğŸ”’ Running Trivy security scan"

# Ejecutar trivy y fallar si detecta HIGH/CRITICAL
# trivy fs --quiet --exit-code 1 .
trivy fs --quiet --exit-code 1 .\yarn.lock
TRIVY_STATUS=$?

if [ $TRIVY_STATUS -ne 0 ]; then
  echo "âŒ Trivy detected vulnerabilities. Push blocked."
  exit 1
fi

echo "âœ… Trivy scan passed."

#echo "ğŸ§ª Running test phase"
#yarn test --run --passWithNoTests
#TEST_STATUS=$?

#if [ $TEST_STATUS -ne 0 ]; then
#  echo "âŒ Tests failed. Push blocked."
#  exit 1
#fi

#echo "âœ… Test phase passed. Push allowed âœ”ï¸"


